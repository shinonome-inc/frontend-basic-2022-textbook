---
title: "Atoms/Input"
date: "2021-12-26"
index: 80
pathToStory: /story/atoms-input--default
figmaNodeId: 5%3A189
---

ここに来ていよいよ難関です。
Reactの新要素が2つも飛び出します。

まずは見た目を作っていきましょう。一つのinput要素に対してスタイルをあてていく感じになります。
index.jsxとstory.jsxを作成してください。

## ディレクトリ構造

```
src
  └ components
    └ Atoms
      └ Input
        ├ index.jsx
        └ story.jsx
```

## コンポーネントの初期化処理

コンポーネントそのものはただの関数であるため、return文の前に様々な処理を実行することができる。
しかし、それらはコンポーネントが再描画される度に毎回実行されてしまう。

再描画は、propsが更新されたとき、別のページで紹介するコンポーネントの"状態"が更新された時、
そしてコンポーネントを呼び出している親要素が更新されたときに発生する。
そのため、コンポーネントを作成したときに最初に一度だけ行いたいような処理も、
普通に書いただけでは親要素が更新されることでもう一度実行されてしまう。

そこで使用するのがuseEffectという関数である。
これは、コンポーネント内の"何が"更新されたときに"何をするか"を指定する関数である。
すなわち、指定したもの以外が変更されていなければ処理を実行しない。

加えて、コンポーネントが作成されたときに一度実行される。
これを利用して初期化処理を記述する。
使い方は次のようになる。
```
import React, {useEffect} from "react";

const Sample = () => {
  useEffect(() => {
    console.log("initialized");
  }, [])

  return null;
}
```
useEffectの第一引数は実行する関数、第二引数は変更を監視する値の配列となる。
この第二引数に空の配列を指定することで、「初期化時に実行して、
それ以降は何の値の変更にも反応しない」という処理を記述することができる。
実際このコンポーネントを設置すると、生成された際に一度だけConsoleに"initialized"を出力する。

## 処理の流れを考える

もう一度完成品をさわりながら、どういった処理が必要かを考えましょう。

このコンポーネントは、タスクの追加及び編集ボタンを押した後に出現します。

編集の場合は、現在のそのタスクのタイトルが入力された状態で出てきます。

また、出現すると同時にinput要素へフォーカスが当てられ、すぐに入力が可能となります。

そして、文字を入力してEnterキーを押す、またはこのコンポーネント以外の場所をクリックする=フォーカスが外れると、
入力した内容でタスクが書き換えられ、このコンポーネントは消えます。

これらの処理のうち、このコンポーネント内でできないものは、
- 入力完了時に入力された内容でタスクを書き換える <- 元のタスクの情報をこのコンポーネントは管理していない
- 自分を消す
です。そのため、これらの処理は今までのonClickのように、設置する際に親要素から指定できるようにします。
この関数をonEditCompleteとします。

また、編集のときにタスクのタイトルを入力しておくために、デフォルトの入力内容も親要素から指定できるようにしましょう。
これが指定されない場合は空文字列を入れておくことで、新規作成の際も対応できます。
この文字列をdefaultValueとします。

処理をまとめると次のようになります。
- defaultValueがinput要素に入力された状態にする
- input要素にフォーカスを当てる
- input要素からフォーカスが外れたイベントがあった際に、onEditCompleteを実行する。
- input要素の入力中にEnterキーが押されたらonEditCompleteを実行する。

これらの処理は一度だけ行えばよいので、先ほど説明したようにuseEffectを用いて初期化処理として記述します。

## input要素の操作

input要素に対する操作をするためには、普通にJavaScriptを書くならば、
要素にidを指定してdocument.getElementByIdを使って…という方法をになりますが、Reactではそれは推奨されません。
代わりにRefというものを介してDOMの操作を行います。

例えばdiv要素のRefを取得して直接スタイルを書き換えるには以下のようにします。
```
import React, {useRef, useEffect} from "react";

const Sample = () => {
  const ref = useRef(null);
  
  useEffect(() => {
    ref.current.style.width = "1000px";
  }, []);

  return <div ref={ref}>extended</div>
}
export default Sample;
```
4行目でrefを定義し、それをreturn内のdivと紐づけることで、**基本的にuseEffect内で**、
ref.currentを介してDOMの操作が可能となります。

これを利用して、input要素へのデフォルト入力値の設定、フォーカスを当てる、イベント処理の登録を行ってみましょう。
input要素のJavaScriptからの制御方法を調べながらやってみてください。
