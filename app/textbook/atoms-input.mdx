---
title: "Atoms/Input"
date: "2021-12-26"
index: 80
pathToStory: /story/atoms-input--default
figmaNodeId: 3%3A620
---

ここに来ていよいよ難関です。
React の新要素が 2 つも飛び出します。

まずは見た目を作っていきましょう。一つの input 要素に対してスタイルをあてていく感じになります。
index.jsx と story.jsx を作成してください。

## ディレクトリ構造

```
src
  └ components
    └ Atoms
      └ Input
        ├ index.jsx
        └ story.jsx
```

## 推奨設計について

作成難易度の高いコンポーネントを中心として、「設計（参考）」という項目を記載してあります。

これは、完成系の React コンポーネントを構成する要素を全て書き下したものとなります。

そのため、これを正しく読み取ることでコンポーネントを作成することができます。

一通り説明に目を通した後、それを確かめながらこの項目を確認し、コードに起こしてみましょう。

ただし、これはあくまで模範解答の設計であるので、他にやり方が思い付くならばそちらを試してみる方が勉強になるのでおすすめです。

以下に、各小項目の説明を示します。

#### Props

このコンポーネントで受け取る props の定義。

**凡例:**

- (props 名): (props の役割等説明)

#### State

このコンポーネント内で使用する State の定義。

**凡例:**

- (state 名): (state の役割等説明) 型=(state のデータ型)、デフォルトの値=(useState を呼び出す際に指定する初期値)

#### Ref

このコンポーネント内で使用する Ref の定義。

**凡例:**

- (ref 名): (ref の参照する要素)

#### Effect

useEffect を用いて実行する処理の一覧。

**凡例:**

##### (useEffect の第二引数)

1. 処理手順
2. 処理手順
3. 処理手順

#### その他の関数(OtherFunc)

コンポーネント内で定義すべきその他の関数の一覧。

**凡例**

##### (関数名)

(関数の説明)

###### 引数: (引数の個数)

- (引数名): (引数の役割等説明)

###### 処理

1. 処理手順
2. 処理手順
3. 処理手順

#### レンダリング

return の中身。描画するコンポーネントの階層構造及び、それぞれに渡す props を示す。

**凡例:**

- (コンポーネント名) (props 名)=(props に指定する値またはその説明)
  - (コンポーネント名)
    - (その他繰り返し処理や条件分岐の指定)
      - (コンポーネント名) (props 名)=(props に指定する値またはその説明)

### その他、styled-components

コンポーネントのレンダリング時に使用するスタイル調整用のコンポーネントなどの定義。

**凡例:**

- (コンポーネント名): (説明、または styled-components の場合は使用する要素名)

## 設計（参考）

### Input コンポーネント

#### Props

- onEditComplete: 入力中に Enter が押された、または input 要素からフォーカスが外れたときに実行するコールバック関数
  引数: 1 つ
  - 1: その時点で input 要素に入力されたテキスト
- defaultValue: この要素を作ったときに最初に input に入れておくテキスト。一度作成したタスクを後から編集するときに使用する。（デフォルトの値 ""）

#### State

なし

#### Ref

- inputRef: input 要素への Ref

#### Effect

##### []（初期化時）

1. \[Ref\]inputRef を介して、input 要素の値に props の defaultValue を設定する。
2. \[Ref\]inputRef を介して、input 要素にフォーカスを当てる。
3. \[Ref\]inputRef を介して、次のイベントリスナを設定する。

- focusout イベント: onEditComplete を呼び出す。このとき、引数に \[Ref\]inputRef を介して取得した、input 要素の値を渡す。
- keypress イベント: 押下されたキーが Enter だったら、次の処理を行う
  - input 要素に設定した focusout イベントのイベントリスナを削除する。
  - \[Props\]onEditComplete を呼び出す。このとき、引数に \[Ref\]inputRef を介して取得した、input 要素の値を渡す。

#### その他関数

なし

#### レンダリング時の処理

なし

#### レンダリング

- StyledInput: ref に \[Ref\]inputRef を指定。

### その他、styled-components

- StyledInput: styled.input

---

## コンポーネントの初期化処理

コンポーネントそのものはただの関数であるため、return 文の前に様々な処理を実行することができる。
しかし、それらはコンポーネントが再描画される度に毎回実行されてしまう。

再描画は、props が更新されたとき、別のページで紹介するコンポーネントの"状態"が更新された時、
そしてコンポーネントを呼び出している親要素が更新されたときに発生する。
そのため、コンポーネントを作成したときに最初に一度だけ行いたいような処理も、
普通に書いただけでは親要素が更新されることでもう一度実行されてしまう。

そこで使用するのが useEffect という関数である。
これは、コンポーネント内の"何が"更新されたときに"何をするか"を指定する関数である。
すなわち、指定したもの以外が変更されていなければ処理を実行しない。

加えて、コンポーネントが作成されたときに一度実行される。
これを利用して初期化処理を記述する。
使い方は次のようになる。

```
import React, {useEffect} from "react";

const Sample = () => {
  useEffect(() => {
    console.log("initialized");
  }, [])

  return null;
}
```

useEffect の第一引数は実行する関数、第二引数は変更を監視する値の配列となる。
この第二引数に空の配列を指定することで、「初期化時に実行して、
それ以降は何の値の変更にも反応しない」という処理を記述することができる。
実際このコンポーネントを設置すると、生成された際に一度だけ Console に"initialized"を出力する。

## 処理の流れを考える

もう一度完成品をさわりながら、どういった処理が必要かを考えましょう。

このコンポーネントは、タスクの追加及び編集ボタンを押した後に出現します。

編集の場合は、現在のそのタスクのタイトルが入力された状態で出てきます。

また、出現すると同時に input 要素へフォーカスが当てられ、すぐに入力が可能となります。

そして、文字を入力して Enter キーを押す、またはこのコンポーネント以外の場所をクリックする=フォーカスが外れると、
入力した内容でタスクが書き換えられ、このコンポーネントは消えます。

これらの処理のうち、このコンポーネント内でできないものは、

- 入力完了時に入力された内容でタスクを書き換える <- 元のタスクの情報をこのコンポーネントは管理していない
- 自分を消す
  です。そのため、これらの処理は今までの onClick のように、設置する際に親要素から指定できるようにします。
  この関数を onEditComplete とします。

また、編集のときにタスクのタイトルを入力しておくために、デフォルトの入力内容も親要素から指定できるようにしましょう。
これが指定されない場合は空文字列を入れておくことで、新規作成の際も対応できます。
この文字列を defaultValue とします。

処理をまとめると次のようになります。

- defaultValue が input 要素に入力された状態にする
- input 要素にフォーカスを当てる
- input 要素からフォーカスが外れたイベントがあった際に、onEditComplete を実行する。
- input 要素の入力中に Enter キーが押されたら onEditComplete を実行する。

これらの処理は一度だけ行えばよいので、先ほど説明したように useEffect を用いて初期化処理として記述します。

## input 要素の操作

input 要素に対する操作をするためには、普通に JavaScript を書くならば、
要素に id を指定して document.getElementById を使って…という方法をになりますが、React ではそれは推奨されません。
代わりに Ref というものを介して DOM の操作を行います。

例えば div 要素の Ref を取得して直接スタイルを書き換えるには以下のようにします。

```
import React, {useRef, useEffect} from "react";

const Sample = () => {
  const ref = useRef(null);

  useEffect(() => {
    ref.current.style.width = "1000px";
  }, []);

  return <div ref={ref}>extended</div>
}
export default Sample;
```

4 行目で ref を定義し、それを return 内の div と紐づけることで、**基本的に useEffect 内で**、
ref.current を介して DOM の操作が可能となります。

これを利用して、input 要素へのデフォルト入力値の設定、フォーカスを当てる、イベント処理の登録を行ってみましょう。
input 要素の JavaScript からの制御方法を調べながらやってみてください。
